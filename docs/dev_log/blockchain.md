#交易池分类
* 转账交易池：按照交易费排序，最多容纳合法转账交易200笔，单个账户最多1笔，nonce相同则选交易费最大的；
* note交易池：按照交易时间排序，不做合法性检查，最多容纳note交易40笔，单个账户最多3笔；
* news交易池：按照交易时间排序，最多容纳news交易40笔，单个账户最多3笔；

其中，news交易也是转账交易的一种，只要符合上述规则，同样会进入转账交易池。

#信号
探索信号携带各类信号的概率：40%的概率携带 新head block信号，20%的概率携带 新转账交易信号，20%的概率携带 新note交易信号，20%的概率携带 新news交易信号，如果上述各项信号都无真实信息承载，则携带在线信号，因此在线信号一般多于链为空的时候比较容易见到。
##信号分类
* 在线信号：由signal id + 时间戳 + chain id构成，探索信号有随机概率发出此信号；
* 节点推荐信号：由signal id + 时间戳 + chain id + 推荐peer构成，当收到不在自己访问列表的节点发出的信号，并且自己访问列表已满，则发出此信号，向对方推荐3分以上的节点供对方探索；
* 新head block信号：由signal id + 时间戳 + chain id + head block hash + peer指针 + 难度值+ 推荐peer构成，当本地最难链发生改变（不管是自己挖矿导致，还是同步到别的链导致）会发出此信号，探索信号也有随机概率发出此信号。收到该信号会首先比较难度值，只有难度值比本地大，才会去get该分支区块；
* 新note交易信号：由signal id + 时间戳 + chain id + note交易hash + peer指针 + 推荐peer构成，当自己发note交易会发出此信号，第一次收到别人的note交易，并且能成功加入note交易池也会发出此信号，探索信号也有随机概率发出此信号。因为note交易是链式结构，为了多获取历史消息，收到该信号会向前连续get最多10条历史note消息，本地已有的数据不会重复get；
* 新news交易信号：由signal id + 时间戳 + chain id + news交易hash + peer指针 + 推荐peer构成，当自己发news交易会发出此信号，第一次收到别人的news交易，并且能成功加入news交易池也会发出此信号，探索信号也有随机概率发出此信号。收到该信号会get 1条news消息；
* 转账交易信号：由signal id + 时间戳 + chain id + 转账交易hash + peer指针 + 交易费 + 推荐peer构成，当自己发转账交易会发出此信号，第一次收到别人的转账交易，并且能成功加入转账交易池也会发出此信号，探索信号也有随机概率发出此信号。收到该信号会首先比较交易费，只有交易费有进去转账交易池的可能，也即转账交易池未满或者转账交易池满了，但是交易费大于排名末尾的交易的交易费，才会去get该转账交易；


#bootstrap
   第一个bootstrap节点由UI扫码或者点击链接传入，libtau会有数据库保存传入节点，当未成功获取到链上数据时，会每次从节点数据库随机挑选一个节点get链数据，首先，会从一个约定的固定key里读取最新的head block hash，然后获取head block，由于每个block里面有一个字段是skip list指针指向genesis block(genesis block该字段为state root)，因此，可以直接从head block里面获得genesis block hash，从而可以直接同步genesis block及其state和news等数据，成功获取之后再补齐genesis block至head block之间的区块完成切链，这整个过程可能会有节点数据过期/网络差等原因导致同步失败，失败了会继续挑选节点尝试，最多尝试10次，并且一旦get过的数据数据库会缓存，不会重复获取。
   
   另外，挑选中去get的节点也会进入访问列表，访问列表会有定时发送的探索信号，如果节点在线，探索信号大概率会推荐其它节点进入访问列表。当访问列表有节点出块，本地节点会收到其发来的new head block信号，根据该信号携带的head block hash，也能获取到完整的链的数据。


#acl维护策略
* 访问列表发送探索信号的频率为接近5s一次，每次发送探索信号，会随机携带不同的信息，或new head block或notes tx或news tx或最大的转账交易，并且探索信号里面也会推荐3分以上的节点回来。如果有真实的信息产生而导致访问列表信号的转发，则该5s内不在发送探索信号；
* 访问列表节点数量为[4, 6]个，少于4个每次会主动随机挑选节点进入访问列表，多余6个，每次会删除评分最低的节点。4 - 6个节点有个2的弹性空间，这样弹性空间的存在，使得后上线的节点总是能找到2个左右的伙伴，不至于形成节点帮派，避免出现某几个节点互相链接至满载而不接受其它节点的情况；
* 进入访问列表初始分数为3分，最低0分，最高5分；
* 访问列表分数调整标准为：收到节点信号，会给节点+1分；10s中没收到节点信号，会给节点-1分，按照5s发一次信号的频率，也就是本来应该收到两个信号，但却一个都没收到，不管是因为网络差丢包还是不在线等其它原因，这都会导致扣分，这个机制对于一个初入访问列表的节点来说，如果不在线，则最多30s会分数降为0而剔除；另外，30s未收到信号，分数会直接将为0分，这个上限设计可以有效地应对节点突然下线的情况，对于一个长时间在线的节点来说，其评分一般正常都会达到满分5分，如果其突然下线，那么按照正常的扣分机制，至少需要50s才能将分扣完将其踢出访问列表，而这个30s的设计，能提前识别这种情况，及时踢出不在线节点；


#consensus
* base target决定了当前的出块难度，base target越大，出块难度越小，base target越大，则出块难度越小，因此base target调整原则总体是如果平均时间间隔变大了，则base target增大，如果平均时间间隔变小了，则base target减小，具体调整规则为：假如前3个区块间隔的平均时间为T，如果T>300s，则base target = previous base target * T / 300，其中T最大为335，如果T<300s，则base target = previous base target - previous base target * （300 - T） / 300 * 0.64，其中T最小为265；
* generation signature = hash(previous generation signature + miner public key)；
* hit = generation signature的前8个字节所形成的整数；
* cumulative difficulty = last cumulative difficulty + 2^64 / base target；
* power仅当出块成功，才会增加1，并且real power = log2(power + 2)，出块者也会获得10个coins的奖励；
* target = base target * real power * time interval；
* 出块需要满足的条件为：target > hit，并且单个账户30分钟之内只能出一个块；
* 每50个区块为一个历元，其中每50个区块的第一个区块为创世区块，创世区块会携带state root和news root，分别携带历史state和历史news消息；



#切链逻辑
* 当发现更难的链才有可能发生切链，所谓更难的链，先比较难度值，难度值更大的为最难的链，难度值相同的情况下再比较head block矿工的public key，public key更大的会被认为是更难的链；
* 由于链的有效期为50个区块，切链之前会先检查两个支链的创世区块，如果更难的链的创世区块和本地链一样，则会去拿到所有缺失的区块，找到分叉点，然后rollback本地支链的区块到分叉点，并connect更难链上的区块。如果更难的链的创世区块和本地链不一样，则直接放弃本地所有数据，获取对方链的区块，并从其创世区块开始解析得到所有数据作为本地链状态；